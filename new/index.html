<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title></title>
    <link rel="stylesheet" type="text/css" href="css/base.css">
    <link rel="stylesheet" type="text/css" href="css/common.css">
    <link rel="stylesheet" type="text/css" href="css/index.css">
    <link rel="stylesheet" type="text/css" href="css/search.css">
    <link rel="stylesheet" type="text/css" href="css/houseInfo.css">
</head>
<body>

    
<div id="topbar" class="topbar"></div>

<div id="header" class="header"></div>

<div class="bc w990 clearfix mt10 mb10">
   
    <div id="factor" class="w238 fl mb20">
        <div class="g_factor m10">
            <h4><a href="#">区域</a></h4>
            <a class="more" href="#">></a>
            <div id="region" class="detail">
            </div>
        </div>
        <div class="g_factor m10">
            <h4><a href="#">租金</a></h4>
            <a class="more" href="#">></a>
            <div id="price" class="detail">
            </div>
        </div>

        <div class="g_factor m10">
            <h4><a href="#">可入住时间</a></h4>
            <a class="more" href="#">></a>
            <div class="detail">
                <a href="#">即可入住</a>
                <a href="#">7天内</a>
                <a href="#">7~15天</a>
                <a href="#">15~30天</a>
                <a href="#">30天~60天</a>
                <a href="#">60天以上</a>
            </div>
        </div>

        <div class="g_factor m10">
            <h4><a href="#">房型</a></h4>
            <a class="more" href="#">></a>
            <div id="room" class="detail">
            </div>
        </div>

        <div class="g_factor m10">
            <h4><a href="#">出租方式</a></h4>
            <a class="more" href="#">></a>
            <div id="type" class="detail">
            </div>
        </div>

        <div class="g_factor m10">
            <h4><a href="#">室友标签</a></h4>
            <a class="more" href="#">></a>
            <div class="detail">
                <a href="#">IT男</a>
                <a href="#">IT女</a>
                <a href="#">设计师</a>
                <a href="#">游戏控</a>
                <a href="#">闺蜜</a>
                <a href="#">驴友</a>
                <a href="#">常年出差</a>
                <a href="#">LOL</a>
            </div>
        </div>
    </div>

    <div class="w740 fr">
        <div class="mb10 clearfix">
            <div id="slide" class="fl">
                
                <div class="pic">
                    <ul>
                        <li>
                            <a href="javascript:void(0)">
                                <img width="540" height="120" alt="" src="images/slide1.png">
                            </a>
                        </li>
                        <li>
                            <a href="javascript:void(0)">
                                <img width="540" height="120" alt="" src="images/slide2.png">
                            </a>
                        </li>
                        <li>
                            <a href="javascript:void(0)">
                                <img width="540" height="120" alt="" src="images/slide3.png">
                            </a>
                        </li>
                    </ul>
                </div>

                <ul class="btns">
                    <li class="cur">
                        1
                    </li>
                    <li class="">
                        2
                    </li>
                    <li class="">
                        3
                    </li>
                </ul>

            </div>

            <ul id="topic" class="fr">
                <li class="topic1">
                    <a target="_blank" href="#">加入租房圈</a>
                </li>
                <li class="topic2">
                    <a target="_blank" href="#">查找好友</a>
                </li>
                <li class="topic3">
                    <a target="_blank" href="#">订阅信息</a>
                </li>
                <li class="topic4">
                    <a target="_blank" href="#">分享本站</a>
                </li>
            </ul>
        </div>

        <div class="mb20">
            <div id="houseNavBar">
           		<span class="cur fl">搜索房源</span>
                <span class="fl">推荐房源</span>
                <span class="fl">好友房源</span>
                <span class="fl">圈子房源</span>
            </div>
            <div id="houseInfo">
            	<div class='homes' id='searchResult'></div>
                <div class="homes">

                    <div class="houseInfo clearfix m10">
                        <div class="g_houseInfo fl">
                            <a class="housePic fl" href="#">
                                <img src="images/house_bg.png" alt="" width="105" height="75">
                                <span>8 图</span>
                            </a>
                            <div class="right">
                                <p class="top"><a href="houseDetail.html">推荐房源</a></p>
                                <p class="middle">立水桥-立水桥-立水桥-立水桥-立水桥-立水桥-立水桥</p>
                                <p class="bottom">便宜-便宜-便宜-便宜-便宜-便宜-</p>
                            </div>
                        </div>

                        <div class="g_person fr">
                            <div class="top">
                                <a class="personPic fl" href="#"><img src="images/person_bg.png" alt="" width="42" height="42"></a>
                                <div class="right">
                                    <strong><a href="#">肖竹君</a></strong>
                                    <p>发布于<em>3</em>天前</p>
                                </div>
                            </div>    
                            <div class="bottom">
                                <span class="fl">租客圈：</span>
                                <div class="link">
                                    <a href="#">百度</a>
                                    <a href="#">百度</a>
                                    <a href="#">百度</a>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>

                <div class="homes">
                    
                    <div class="houseInfo clearfix m10">
                        <div class="g_houseInfo fl">
                            <a class="housePic fl" href="#">
                                <img src="images/house_bg.png" alt="" width="105" height="75">
                                <span>8 图</span>
                            </a>
                            <div class="right">
                                <p class="top"><a href="houseDetail.html">好友房源</a></p>
                                <p class="middle">立水桥-立水桥-立水桥-立水桥-立水桥-立水桥-立水桥</p>
                                <p class="bottom">便宜-便宜-便宜-便宜-便宜-便宜-</p>
                            </div>
                        </div>

                        <div class="g_person fr">
                            <div class="top">
                                <a class="personPic fl" href="#"><img src="images/person_bg.png" alt="" width="42" height="42"></a>
                                <div class="right">
                                    <strong><a href="#">肖竹君</a></strong>
                                    <p>发布于<em>3</em>天前</p>
                                </div>
                            </div>    
                            <div class="bottom">
                                <span class="fl">租客圈：</span>
                                <div class="link">
                                    <a href="#">百度</a>
                                    <a href="#">百度</a>
                                    <a href="#">百度</a>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>  

                <div class="homes">
                    
                    <div class="houseInfo clearfix m10">
                        <div class="g_houseInfo fl">
                            <a class="housePic fl" href="#">
                                <img src="images/house_bg.png" alt="" width="105" height="75">
                                <span>8 图</span>
                            </a>
                            <div class="right">
                                <p class="top"><a href="houseDetail.html">圈子房源</a></p>
                                <p class="middle">立水桥-立水桥-立水桥-立水桥-立水桥-立水桥-立水桥</p>
                                <p class="bottom">便宜-便宜-便宜-便宜-便宜-便宜-</p>
                            </div>
                        </div>

                        <div class="g_person fr">
                            <div class="top">
                                <a class="personPic fl" href="#"><img src="images/person_bg.png" alt="" width="42" height="42"></a>
                                <div class="right">
                                    <strong><a href="#">肖竹君</a></strong>
                                    <p>发布于<em>3</em>天前</p>
                                </div>
                            </div>    
                            <div class="bottom">
                                <span class="fl">租客圈：</span>
                                <div class="link">
                                    <a href="#">百度</a>
                                    <a href="#">百度</a>
                                    <a href="#">百度</a>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>

            </div>
        </div>
    </div>
</div>

<div id="footer" class="footer">尾部</div>

	<script type="text/javascript" src="js/jquery-1.7.2.min.js"></script>
	<script type="text/javascript" src="js/common.js"></script>
	<script type="text/javascript" src="js/slide.js"></script>
	<script src="/js/config.js" type="text/javascript"></script>
	<script src="/js/urlUtil.js" type="text/javascript"></script>
	<script src="/js/resouce.js" type="text/javascript"></script>
	<script src="/js/house.js" type="text/javascript"></script>
<script type="text/javascript">
var hrefstr=window.location.href;
var key=test("key");
var price=test("price");
var region=test("region");
var room=test("room");
var type=test("type");

function showTabByIndex(index)
{
	var $this = $("#houseNavBar .fl").eq(index);
	$this.siblings().removeClass("cur");
    $this.addClass("cur");
    $("#houseInfo .homes").hide();
    $("#houseInfo .homes").eq(index).show();
}

$(function(){
	showTabByIndex(0);
    //$("#houseInfo .homes").eq(0).show();

    $("#houseNavBar span").mouseover(function(){
        var $this = $(this), index = $this.index();
        $this.siblings().removeClass("cur");
        $this.addClass("cur");
        $("#houseInfo .homes").hide();
        $("#houseInfo .homes").eq(index).show();
    });
    
for(var i=0;i<region_array.length;i++){
    var newNode = document.createElement("a");
    newNode.href=getretionlink(key,price,region,room,type,region_array[i][0],1);
    newNode.type='region';
    newNode.value = region_array[i][0];
    newNode.class="region_"+region_array[i][0];
    newNode.innerHTML=region_array[i][1];
    var parent = $("#region").append(newNode);
}
for(var i=0;i<price_array.length;i++){
    var newNode = document.createElement("a");
    newNode.href=getretionlink(key,price,region,room,type,price_array[i][0],2);
    newNode.type='price';
    newNode.value = price_array[i][0];
    newNode.class="price_"+price_array[i][0];
    newNode.innerHTML=price_array[i][1];
    var parent = $("#price").append(newNode);
}
for(var i=0;i<room_array.length;i++){
    var newNode = document.createElement("a");
    newNode.href=getretionlink(key,price,region,room,type,room_array[i][0],3);
    newNode.type='room';
    newNode.value = room_array[i][0];
    newNode.class="room_"+room_array[i][0];
    newNode.innerHTML=room_array[i][1];
    var parent = $("#room").append(newNode);
}
for(var i=0;i<type_array.length;i++){
    var newNode = document.createElement("a");
    newNode.href=getretionlink(key,price,region,room,type,type_array[i][0],4);
    newNode.type='type';
    newNode.value = type_array[i][0];
    newNode.class="type_"+type_array[i][0];
    newNode.innerHTML=type_array[i][1];
    var parent = $("#type").append(newNode);
    
}
var data = {};
getPramsFromUrl(data,key,price,region,room,type);
$.post($.URL.house.houselist,data,searchCallback,"json");
//$.post($.URL.house.houselist,data,callback,"json");

$("#factor a").click(function(){
	$(this).addClass('selected').siblings().removeClass('selected');
	linkType = $(this).attr("type");
	if(linkType=='region')
	{
		region = $(this).attr("value");
	}
	else if(linkType=='type')
	{
		type = $(this).attr("value");
	}
	else if(linkType=='price')
	{
		price = $(this).attr("value");
	}
	else if(linkType=='room')
	{
		room = $(this).attr("value");
	}
	var data = {};
	getPramsFromUrl(data,key,price,region,room,type);
	$.post($.URL.house.houselist,data,searchCallback,"json");

	return false;
});
});

	//回调函数
	function searchCallback(result)
	{
		showTabByIndex(0);
		
		if(result.current_count==0){
			$('#searchResult').html("亲，没有检索到相匹配的房源哦！");
		}else{
			renderingPage(result);
			$('.houseItem').click(function(){
				location=$.URL.house.info+"?id="+$(this).attr("houseId");
			});
		}
	}
	
	function getPramsFromUrl(data,key,price,region,room,type){
	if(key!=""){
		data['key']=key;
	}
	if(price!=""){
		data['price']=price;
	}
	if(region!=""){
		data['region']=region;
	}
	if(room!=""){
		data['room']=room;
	}
	if(type!=""){
		data['type']=type;
	}
	}

function getLeftDays(days){
	var result ="";
	if(days>=365){
		result += parseInt(days/365) + "年";
		days=days%365;
	} 
	if(days>=30){
		result += parseInt(days/30) + "月";
		days=days%30;
	}
	if(days>=7){
		result += parseInt(days/7) +"周";
		days = days%7;
	}
	if(days!=0){
		result += days + "天";
	}
	return result;
}	
	
function renderingPage(data){
	if(data.houseinfo_list.length==0){
		$("#searchResult").html("没有找到合适的房子！");
	}else {
		$("#searchResult").html("");
		for(var i=0;i<data.current_count;i++){
			var houseInfo = $("<div class='houseInfo clearfix m10'></div>");
			var houseDetail = $("<div class='g_houseInfo fl'></div>");
			var houseDetailInfo = $("<div class='right'></div>");
			var houseImg = $("<a class='housePic fl' href='houseDetail.html?id="+data.houseinfo_list[i].houseId+"'><img src='images/house_bg.png' alt='' width='105' height='75'><span>8 图</span></a>");
			var houseTitle = $("<p class='top'><a href='houseDetail.html?id="+data.houseinfo_list[i].houseId+"'>"+ data.houseinfo_list[i].title +"</a></p>");
			var houseAddress = $("<p class='middle'>"+data.houseinfo_list[i].street+data.houseinfo_list[i].community+"</p>");
			var housePrice = $("<p class='bottom'>"+data.houseinfo_list[i].price+"元/月</p>");
			houseDetailInfo.append(houseTitle).append(houseAddress).append(housePrice);
			houseDetail.append(houseImg).append(houseDetailInfo);
			var personInfo = $("<div class='g_person fr'></div>");
			var personTop = $("<div class='top'></div>");
			var personImg = $("<a class='personPic fl' href='#'><img src='images/person_bg.png' alt='' width='42' height='42'></a>");
			var personTopRight = $("<div class='right'></div>");
			var personName = $(" <strong><a href='#'>"+data.houseinfo_list[i].realName+"</a></strong>");
			var transferTime = $("<p><em>"+ getLeftDays(data.houseinfo_list[i].leftDays) +"</em>后出租</p>");
			var personBottom = $("<div class='bottom'></div>");
			var community = $("<span class='fl'>租客圈：</span>");
			var link =$("<div class='link'><a href='#'>"+data.houseinfo_list[i].collegeName+"</a><a href='#'>"+data.houseinfo_list[i].companyName+"</a></div>");
			personTopRight.append(personName).append(transferTime);
			personTop.append(personImg).append(personTopRight);
			personBottom.append(community).append(link);
			personInfo.append(personTop).append(personBottom);
			houseInfo.append(houseDetail).append(personInfo);
			$('#searchResult').append(houseInfo);
		}
	}
	
}
function getretionlink(key,price,region,room,type,value,category){
	var link=$.URL.house.houselist;
	if(category==1){
		link+="?region="+value;
		if(key!=""){
			link+="&key="+key;
		}
		if(price!=""){
			link+="&price="+price;
		}
		if(room!=""){
			link+="&room="+room;
		}
		if(type!=""){
			link+="&type="+type;
		}
	}
	if(category==2){
		link+="?price="+value;
		if(key!=""){
			link+="&key="+key;
		}
		if(region!=""){
			link+="&region="+region;
		}
		if(room!=""){
			link+="&room="+room;
		}
		if(type!=""){
			link+="&type="+type;
		}
	}
	if(category==3){
		link+="?room="+value;
		if(key!=""){
			link+="&key="+key;
		}
		
		if(region!=""){
			link+="&region="+region;
		}
		if(price!=""){
			link+="&price="+price;
		}
		if(type!=""){
			link+="&type="+type;
		}
	}
	if(category==4){
		link+="?type="+value;
		if(key!=""){
			link+="&key="+key;
		}
		
		if(region!=""){
			link+="&region="+region;
		}
		if(price!=""){
			link+="&price="+price;
		}
		if(room!=""){
			link+="&room="+room;
		}
	}
	if(category==5){
		link+="?key="+value;
		if(type!=""){
			link+="&type="+type;
		}
		
		if(region!=""){
			link+="&region="+region;
		}
		if(price!=""){
			link+="&price="+price;
		}
		if(room!=""){
			link+="&room="+room;
		}
	}
	return link;
}

function test(paramName)  
{  
    var reg = new RegExp("(^|\\?|&)"+ paramName+"=([^&]*)(\\s|&|$)", "i");
  
    if (reg.test(hrefstr)) //test为script ID 
        return URL.decode(RegExp.$2); 
    else
        return "";
}
</script>
</body>
</html>