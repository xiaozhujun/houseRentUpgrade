<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>我的好友</title>
    <link rel="stylesheet" type="text/css" href="css/base.css">
    <link rel="stylesheet" type="text/css" href="css/common.css">
    <link rel="stylesheet" type="text/css" href="css/myFirend.css">
    
    <link rel="stylesheet" type="text/css" href="css/myHouseInfo.css">
</head>
<body>
    
<div id="topbar" class="topbar"></div>

<div id="header" class="header"></div>

<div class="bc w990 clearfix mt10 mb10">
    
    <div class="g_userInfo p10">
        <a class="userPic fl" href="#">
            <img src="images/person_bg.png" alt="" width="120" height="120">
        </a>
        <div class="right">
            <h5><em id="realNameContainer"></em><a href="userSet.html">编辑个人资料</a></h5>
            <ul>
                <li id="interestContainer">
                    <strong>兴趣爱好:</strong>
                </li>
                <li id="educationContainer">
                    <strong>教育背景:</strong>
                </li>
                <li id="jobContainer">
                    <strong>工作经历:</strong>
                </li>
            </ul>
        </div>
    </div>

    <div class="mt10 mb10 clearfix ">
        
        <ul class="g_leftlan fl">
            <li>
                <h5>我的房屋信息</h5>
                <p onclick="window.location='collectHouseInfo.html'">我收藏的房源</p>
                <p onclick="window.location='publishHouseInfo.html'">我发布的房源</p>
            </li>
            <li>
                <h5>我的关系</h5>
                <p onclick="window.location='myCircle.html'">圈子</p>
                <p class="cur" onclick="window.location='myFriend.html'">好友</p>              
            </li>
            <li>
                <h5>系统</h5>
                <p onclick="window.location='systemInform.html'">通知</p>
                <p onclick="window.location='userSet.html'">个人设置</p>
                <p onclick="window.location='changePassword.html'">密码设置</p>
            </li>
        </ul>

        <div class="fr w795 ml10 myFirendList">
            <h3 class="title">我的好友</h3>

            <ul class="navList mt10">
                <li id="friendListTab" class="cur">
                    我的好友 <em id="friendCount"></em>
                </li>
                <li id="applyTab">
                    好友申请<em id="applyCount"></em>
                </li>
                <li>
                   我的关注 <em>(69)</em>
                </li>
            </ul>
            
            <div id="friendListDiv" class="listWrap">  
                <ul id="friendListUL" class="g_fb myFirendListUl">
                </ul>
            </div>
            <div id="friendApplyDiv" class="listWrap"> 
            	<table class="tbHouseInfo" border="0" cellspacing="1" cellpadding="0" width="100%">
                <thead>
                    <tr>
                        <th class="applyTD">申请人</th>
                        <th class="applyTD">申请信息</th>
                        <th class="act">操作</th>
                    </tr>
                </thead>
                <tbody id="friendApplyList">
                </tbody>
              </table>   
            </div>
        </div>
    </div>
</div>

<div id="footer" class="footer">尾部</div>

<script type="text/javascript" src="js/jquery-1.7.2.min.js"></script>
<script src="/js/config.js" type="text/javascript"></script>
<script src="/js/urlUtil.js" type="text/javascript"></script>
<script type="text/javascript" src="js/common.js"></script>
<script type="text/javascript">
$(function(){
	$("#friendApplyDiv").hide();
	
	$.get($.URL.user.info,null,userInfoCallback,"json");
	
	$.get($.URL.friend.friendList,null,getFriendListCallback,"json");
	
	$("#joinTab").click(function(){
		$("#joinCommunityDiv").show();
		$("#joinTab").addClass("cur");
		$("#manageCommunityDiv").hide();
		$("#manageTab").removeClass("cur");
	});
	
	$("#applyTab").click(function(){
		$("#applyTab").siblings().removeClass("cur");
		$("#applyTab").addClass("cur");
		$("#friendApplyDiv").show();
		$("#friendListDiv").hide();
		
		if($("#friendApplyList").html().trim()==""){
			$.get($.URL.friend.applyingUntreat,null,getApplyListCallback,"json");
		}
	});
	
	$("#friendListTab").click(function(){
		$("#friendListTab").siblings().removeClass("cur");
		$("#friendListTab").addClass("cur");
		$("#friendApplyDiv").hide();
		$("#friendListDiv").show();
	});
});

function getApplyListCallback(data){
	
	for(var i=0;i<data.list.length;i++){
		var friendApplyTR = $(' <tr></tr>');
		var applyUserTD = $('<td class="applyUserTD"></td>');
		var applyInfoTD = $('<td class="applyTD"></td>');
		var houseInfo = $("<div class='houseInfo clearfix m10 w660'></div>");
		applyInfoTD.html(data.list[i].authInfo);
		var personInfo = $("<div class='g_person fl'></div>");
		var personTop = $("<div class='top'></div>");
		var personImg = $("<a class='personPic fl' href='#'><img src='images/person_bg.png' alt='' width='42' height='42'></a>");
		var personTopRight = $("<div class='right'></div>");
		var personName = $(" <strong><a href='#'>"+data.list[i].fromRealName+"</a></strong>");
		var interest = $("<p></p>");
		for(var x=0;x<data.list[i].tags.length;x++){
			interest.append(data.list[i].tags[x].tagName+"&nbsp;");
		}
		var personBottom = $("<div class='bottom'></div>");
		var community = $("<span class='fl'>租客圈：</span>");
		var link =$("<div class='link'></div>");
		if(typeof(data.list[i].circles)!="undefined")
			{
				for(var j=0;j<data.list[i].circles.length;j++)
				{
					var circleLink = $("<a href='#'></a>");
					circleLink.html(data.list[i].circles[j].name);
					circleLink.attr("href","circleIndex.html?circle="+URL.encode(data.list[i].circles[j].name));
					link.append(circleLink);
				}
			}
		
		personTopRight.append(personName).append(interest);
		personTop.append(personImg).append(personTopRight);
		personBottom.append(community).append(link);
		personInfo.append(personTop).append(personBottom);
		applyUserTD.append(personInfo);
		//applyInfoTD.append(houseDetail);
		//houseInfo.append(personInfo).append(houseDetail);
		
		var houseActionTD = $('<td class="act"><a href="#">通过</a>&nbsp;<a href="#">拒绝</a></td>');
		//applyTD.append(houseInfo);
		friendApplyTR.append(applyUserTD).append(applyInfoTD).append(houseActionTD);
		
		$(friendApplyList).append(friendApplyTR);
	}
}

function userInfoCallback(data){
	var tags = "";
	if(data.tags!=null){
		for(var i=0;i<data.tags.length;i++){
			tags+=data.tags[i].tagName + "&nbsp;&nbsp;";
		}
	}
	
	$("#interestContainer").append(tags);
	$("#jobContainer").append(data.company)
	$("#educationContainer").append(data.college);
	$("#realNameContainer").append(data.info.realName);
}

function getFriendListCallback(data){
	$("#friendCount").html("("+data.friendCount+")");
	$("#applyCount").html("("+data.applyCount+")");
	$("#friendListUL").html("");
	for(var x=0;x<data.friendList.length;x++){
		var li = $('<li></li>');
		var imgLink = $('<a class="img" href="#"></a>');
		var img = $('<img src="images/person_bg.png" alt="" width="42" height="42">');
		imgLink.append(img);
		li.append(imgLink);
		var div = $('<div class="right"></div>');
		var strong = $('<strong></strong>');
		var nameLink = $('<a href="#"></a>');
		strong.append(nameLink);
		nameLink.append(data.friendList[x].toUserName);
		var p = $('<p class="atw"></p>');
		var addLink = $('<a class="add" href="#">♥ 关注</a>');
		p.append(addLink);
		div.append(strong).append(p)
		var briefDiv = $('<div class="brief"></div>');
		var i = $('<i>简介：</i>');
		briefDiv.append(i);
		for(var j=0;j<data.friendList[x].tags.length;j++){
			briefDiv.append(data.friendList[x].tags[j].tagName+"&nbsp;");
		}
		li.append(imgLink).append(div).append(briefDiv);
		$("#friendListUL").append(li);
	}
}

</script>
</body>
</html>