<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Document</title>
	<link rel="stylesheet" type="text/css" href="css/base.css">
    <link rel="stylesheet" type="text/css" href="css/common.css">
    <link rel="stylesheet" type="text/css" href="css/houseDetail.css">
</head>
<body>
<div id="topbar" class="topbar"></div>

<div id="headerNoSearch" class="header mb10"></div>

<div class="w990 bc clearfix mb10" id="housemain">
   
</div>
<!-- <div></div> -->
<div id="footer" class="footer">尾部</div>
<script type="text/javascript" src="js/jquery-1.7.2.min.js"></script>
<script type="text/javascript" src="js/common.js"></script>
<script type="text/javascript" src="js/houseDetail.js"></script>
<script src="/js/config.js" type="text/javascript"></script>
<script src="/js/urlUtil.js" type="text/javascript"></script>
<script src="/js/resouce.js" type="text/javascript"></script>
<script src="/js/emptyNote.js" type="text/javascript"></script>
<script src="/js/house.js" type="text/javascript"></script>
<script type="text/javascript" src="/js/fancybox/jquery.mousewheel-3.0.4.pack.js"></script>
<script type="text/javascript" src="/js/fancybox/jquery.fancybox-1.3.4.pack.js"></script>
<script src="/js/jquery-dateFormat.js" type="text/javascript"></script>
<script type="text/javascript" src="http://api.map.baidu.com/api?v=1.5&ak=0414726b722ea5ad257d0b96a3c6117a"></script>
<script src="js/getParam.js"></script>
<script type="text/javascript">
	//var houseId = {$houseInfo['houseId']};
	var replyComment = null;
	$(document).ready(function(){
		//var houseId=$.jquery.get("id");
		//alert(houseId);
		var houseId=decodeURI($.getUrlVar('id'));
		$("input").emptyValue();
		/* $.get(house/info+"?id="+houseId,null,houseinfoCallback,"json"); */
		$.ajax(
      {
        type:"GET",
        url:"/House/info?id="+houseId,
        dataType:"json",
        success:function(data){
        houseinfoCallback(data);
        }
        ,error:function(){
         alert("error");
        }
      }    );
		$.get($.URL.house.streetHouseList+"?street={$houseInfo['street']}",null,streetHouseCallback,"json");
		$.get($.URL.houseComment.commentList+"?houseId="+houseId,null,commentListCallback,'json');
		
		$("a.addFriendBtn").fancybox({
							'transitionIn'	:	'elastic',
							'transitionOut'	:	'elastic',
							'speedIn'		:	200, 
							'speedOut'		:	200, 
							'overlayShow'	:	false
							});
							
		$('#loginBtn').click(function(){
				var data = {};
				data.email = $('#emailLoginInput').val();
				data.password = $('#pwdLoginInput').val();
				$.post($.URL.user.login,data,loginCallback,"json");
			});
			
		$("#collectBtn").click(function(){
			var data = {};
			data.houseId = houseId;
			$.post($.URL.houseCollect.collect,data,collectCallback,'json');
		});
		
		$("#commentBtn").click(function(){
			var comment = $("#commentInput").val();
			if(comment=="请输入您的评价！"||comment=="")
			{
				alert("请输入评论内容！");
				return;
			}
		
			var data = {};
			data.houseId = houseId;
			data.comment = comment;
			if(replyComment!=null)
			{
				data.replyComment = replyComment;
			}
			$.post($.URL.houseComment.comment,data,commentCallback,'json');
		});
		
		showHouseLocation();
	});
	
	function showHouseLocation()
	{
		var map = new BMap.Map("allmap");
var point = new BMap.Point(116.331398,39.897445);
map.centerAndZoom(point,12);
// 创建地址解析器实例
var myGeo = new BMap.Geocoder();
// 将地址解析结果显示在地图上,并调整地图视野
myGeo.getPoint("{$houseInfo['street']}{$houseInfo['community']}", function(point){
  if (point) {
    map.centerAndZoom(point, 16);
    map.addOverlay(new BMap.Marker(point));
  }
}, "北京市");
	}
	
	//评论列表回调
	function commentListCallback(result)
	{
		$("#commentList").html("");
		$.each(result.commentList,function(index,item){
			var commentRow = $("<div class='commentRow'></div>");
			var commentTitle = $("<div class='commentTitle'></div>")
			var commentUser = $("<div class='commentUser'>"+item.realName+" 评论说：</div>");
			var commentTime = $("<div class='commetTime'>评论时间："+item.createTime+"</div>")
			var commentContent = $("<div class='commentContent'>"+item.comment+"</div>");
			
			commentTitle.append(commentUser).append(commentTime);
			commentRow.append(commentTitle).append(commentContent);
			$("#commentList").append(commentRow);
		});
	}
	//房源详细信息回调
	
	function houseinfoCallback(data) {
		$("#housemain").html("");
		var houseDetailInfo = $("<div class='fl w740 mb20' id='houseDetailInfo'></div>");
		var detail = $("<div class='detail'></div>");
		var title = $("<div class='bigtitle'><h3>" + data.houseinfo.title
				+ "</h3></div>");
		var fabutime = $("<div class='fabutime'>"+data.houseinfo.transferTime+"</div>");
		var mb20 = $("<div class='clearfix mb20'></div>");
		var gallery = $("<div class='fl w240 gallery'>");
		var bimgslide = $("<div class='bimg_slide'><span><img src='images/house1.png' alt=''></span></div>");
		var simgslide = $("<div class='simg_slide'></div>");
		var aa = $("<a class='btn btnl fl' href='javascript:void(0)'></a><a class='btn btnr fr' href='javascript:void(0)'></a>");
		var imgcontain = $("<div class='imgcontain picContain'><ul><li><img src='images/house1.png' alt=''></li><li><img src='images/house1.png' alt=''></li>"
				+ "<li><img src='images/house1.png' alt=''></li><li><img src='images/house1.png' alt=''></li>"
				+ "<li><img src='images/house1.png' alt=''></li><li><img src='images/house1.png' alt=''></li><li><img src='images/house1.png' alt=''>"
				+ " </li></ul></div>");
		var sumary = $("<ul class='fr w450 sumary'></ul>");
		var price = $("<li><div class='su_tit'>租金价格：</div><div class='su_con'><span class='bigpri'>"
				+ data.houseinfo.price
				+ "</span>"
				+ "  元/月<span class=''>　押一付一</span></div></li>");
		var housetype = $("<li><div class='su_tit'>房屋户型：</div><div class='su_con'>"
				+ data.houseinfo.rentType+ "</div></li>");
		var housecondition = $("<li><div class='su_tit'>房屋情况：</div><div class='su_con'> 普通住宅   精装修　朝向南　</div></li>");
		var layer = $("<li><div class='su_tit'>所属楼层：</div><div class='su_con'>"+data.houseinfo.currentFloor+"</div></li>");
		var area = $("<li><div class='su_tit'>所在区域：</div><div class='su_con'>"+data.houseinfo.street+"--"+data.houseinfo.community+"</div></li>");
		var address = $("<li><div class='su_tit'>所在地址：</div><div class='su_con'>通州小潞邑 龙旺庄向东100米 新潮嘉园对面</div></li>");
		var tel = $("<li><div class='su_tit'>联系方式：</div><div class='su_con'><span class='tel'>"+data.houseinfo.contactPhone+"</span></div></li>");
		var shoucang = $("<li><span class='stow'><a href='#'>收 藏</a></span></li>");
		var housedescrib = $(" <div class='house_describ mb20'></div>");
		var topmb10 = $("<div class='top mb10'><a href='#'>房源描述</a></div>");
		var peizhi = $(" <div class='peizhi'><strong>房屋配置：</strong><span> 衣柜 </span><span> 洗衣机 </span><span> 空调 </span><span> 热水器 </span>"
				+ "<span> 宽带 </span><span> 暖气</span></div>");
		var wordbox = $(" <div class='mb20 mt20 wordbox'><p>房屋信息</p><p>房屋信息</p><p>房屋信息</p><p>房屋信息</p></div>");
		var bigimgslide = $("<div class='bigimg_slide'></div>");
		var bigimgcontain = $("<div class='bigimgcontain picContain'></div>");
		var ulpic = $("<ul class='clearfix'><li><img src='images/house1.png' alt=''> </li><li><img src='images/house1.png' alt=''>"
				+ "  </li><li><img src='images/house1.png' alt=''> </li><li><img src='images/house1.png' alt=''></li><li>"
				+ "<img src='images/house1.png' alt=''></li><li> <img src='images/house1.png' alt=''></li><li><img src='images/house1.png' alt=''></li></ul>");
		var zuke = $("<div class='fr w238 mb20 colMenu'><h3 class='m10'>租客信息</h3></div>");
		var gjm10 = $("<div class='g_j m10'></div>");
		var picfl = $(" <a class='pic fl' href='#'><img src='images/person_bg.png' alt='' width='80' height='80'></a>");
		var right = $("<div class='right'><strong><a class='name' href='#'>"+data.houseuser.name+"</a></strong><p class='ring'><a href='#'>"+data.company+"</a><a href='#'>"+data.college+"</a>"
				+ "</p><a class='add' href='#'>+ 加为好友</a></div>");
		var borderbar = $("<div class='borderbar'></div>");
		var pr10 = $("<div class='clearfix pl10 pr10'><h3 class='fl'>租客圈内好友</h3><a class='fr' href='#'>换一批</a></div>");
		var grm10 = $("<ul class='g_r m10'></ul>");
		var m10li = $(" <li><a class='pic' href='#'><img src='images/person_bg.png' alt='' width='42' height='42'></a>"
				+ " <strong><a class='name' href='#'>肖竹君</a></strong><a class='add' href='#'>+ 加为好友</a></li>");
		var pl10pr10 =$( "<div class='clearfix pl10 pr10'><h3 class='fl'>相关房源推荐</h3><a class='fr' href='#'>换一批</a></div>");
		var grh = $("<ul class='g_rh'><li><a class='pic' href=''><img src='images/house_bg.png' width='180' height='120' alt=''></a>"
				+ "<a href='#'>立水桥-立水桥-立水桥-立水桥-立水桥-立水桥</a></li><li><a class='pic' href=''><img src='images/house_bg.png' width='180' height='120' alt=''></a>"
				+ "<a href='#'>立水桥-立水桥-立水桥-立水桥-立水桥-立水桥</a></li></ul>");
		simgslide.append(aa).append(imgcontain);
		sumary.append(price).append(housetype).append(housecondition).append(
				layer).append(area).append(address).append(tel)
				.append(shoucang);
		gallery.append(bimgslide).append(simgslide);
		bigimgcontain.append(ulpic);
		bigimgslide.append(aa).append(bigimgcontain);
		housedescrib.append(topmb10).append(peizhi).append(wordbox).append(
				bigimgslide);
		mb20.append(gallery).append(sumary);
		detail.append(title).append(fabutime).append(mb20).append(housedescrib);
		houseDetailInfo.append(detail);
		gjm10.append(picfl).append(right);
		grm10.append(m10li).append(m10li).append(m10li).append(m10li).append(m10li).append(m10li);
		zuke.append(gjm10).append(borderbar).append(pr10).append(grm10)
				.append(borderbar).append(pl10pr10).append(grh);
		houseDetailInfo.append(detail);
		$("#housemain").append(houseDetailInfo).append(zuke);
	}
	//评论回调
	function commentCallback(result) {
		if (result.success) {
			$("#commentInput").val('请输入您的评价！');
			$.get($.URL.houseComment.commentList + "?houseId=" + houseId, null,
					commentListCallback, 'json');
		} else {
			alert(result.msg);
		}
	}

	//收藏房源回调
	function collectCallback(result) {
		if (result.result) {
			alert("收藏成功");
		} else {
			alert(result.msg);
		}
	}

	//街道相对应的房源
	function streetHouseCallback(result) {
		$.each(result.houseList,
				function(index, value) {

					var houseInfo = $("<div class='houseItem'></div>");
					houseInfo.attr('houseId', value.houseId);
					var title = $("<div class='houseItemColumn'></div>")
							.append(value.title);
					var price = $("<div class='houseItemColumn'></div>")
							.append(value.price).append("&nbsp;元/月");
					var type = $("<div class='houseItemColumn'></div>").append(
							"房屋户型： " + value.room + "室" + value.parlor + "厅"
									+ value.washroom + "卫");
					var transferTime = $("<div class='houseItemColumn'></div>")
							.append(
									"出租时间： "
											+ $.format.date(value.transferTime,
													"yyyy-MM-dd"));
					houseInfo.append(title).append(price).append(type).append(
							transferTime);
					$("#houseList").append(houseInfo);
				});

		$('.houseItem').click(function() {
			location = $.URL.house.info + "?id=" + $(this).attr("houseId");
		});
	}

	//登录回调函数
	function loginCallback(result) {
		if (result.success) {
			location.reload();
		} else {
			$('#loginMsg').html(result.msg);
		}

	}
</script>


</body>
</html>